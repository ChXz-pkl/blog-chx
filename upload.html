<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Upload - RZF Academy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f9ff;
        }

        .navbar-custom {
            background: linear-gradient(to right, #007BFF, #00BFFF);
        }

        .form-box {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
        }

        footer {
            background: #f8f9fa;
            padding: 10px;
        }
    </style>
</head>

<body onload="cekLogin()" class="d-flex flex-column min-vh-100">

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom navbar-dark px-3">
        <a class="navbar-brand fw-bold" href="dashboard.html">RZF Academy</a>
        <div class="ms-auto d-flex align-items-center">
            <button onclick="logout()" class="btn btn-outline-light btn-sm">Logout</button>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <div class="container my-5">
        <div class="form-box mx-auto" style="max-width: 600px;">
            <h4 class="text-primary text-center mb-4">Unggah Karya Anda</h4>
            <form onsubmit="return handleUpload(event)">
                <div class="mb-3">
                    <label class="form-label">Judul Konten</label>
                    <input type="text" id="judul" class="form-control" required />
                </div>

                <div class="mb-3">
                    <label class="form-label">Kategori</label>
                    <select id="kategori" class="form-select" required>
                        <option value="">Memuat...</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Jenis Konten</label>
                    <select onchange="toggleField()" id="jenis" class="form-select" onchange="toggleField()" required>
                        <option value="">-- Pilih Jenis --</option>
                        <option value="gambar">Gambar</option>
                        <option value="teks">Teks</option>
                    </select>
                </div>
                <div class="mb-3" id="fieldGambar" style="display: none;">
                    <label class="form-label">Pilih Gambar</label>
                    <input type="file" id="gambar" class="form-control" accept=".jpg,.jpeg,.png,.gif" required />
                </div>


                <div class="mb-3" id="fieldTeks" style="display: none;">
                    <label class="form-label">Isi Teks</label>
                    <textarea id="teks" class="form-control" rows="5"></textarea>
                </div>

                <button type="submit" class="btn btn-success w-100">Upload</button>
            </form>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="mt-auto text-center text-muted py-3" style="background:#f8f9fa;">
        &copy; 2025 <a href="https://portfolio-chx.netlify.app/"
            class="text-decoration-none fw-semibold text-dark">CHX</a> â€¢ All rights
        reserved.
    </footer>

    <script>
        function cekLogin() {
            if (!localStorage.getItem("userId")) {
                alert("Silakan login terlebih dahulu.");
                window.location.href = "login.html";
            }
        }

        function logout() {
            localStorage.removeItem("loggedInUser");
            alert("Anda telah logout.");
            window.location.href = "index.html";
        }


        function toggleField() {
            const jenis = document.getElementById("jenis").value;
            document.getElementById("fieldGambar").style.display = jenis === "gambar" ? "block" : "none";
            document.getElementById("fieldTeks").style.display = jenis === "teks" ? "block" : "none";
        }

        function handleUpload(e) {
            e.preventDefault();

            const judul = document.getElementById("judul").value.trim();
            const kategori = document.getElementById("kategori").value;
            const jenis = document.getElementById("jenis").value;
            const teks = document.getElementById("teks").value.trim();
            const userId = localStorage.getItem("userId");
            const userName = localStorage.getItem("userName");

            // Validasi gambar jika jenis adalah "gambar"
            if (jenis === "gambar") {
                const fileInput = document.getElementById("gambar");
                const file = fileInput.files[0];

                if (!file) {
                    alert("Pilih file gambar terlebih dahulu.");
                    return;
                }

                const allowedTypes = ["image/jpeg", "image/png", "image/gif"];
                if (!allowedTypes.includes(file.type)) {
                    alert("Tipe file tidak didukung. Gunakan .jpg, .jpeg, .png, atau .gif");
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    const konten = {
                        id: Date.now().toString(),
                        userId,
                        userName,
                        judul,
                        kategori,
                        jenis,
                        gambar: e.target.result, // hasil base64
                        teks: null,
                        waktu: new Date().toISOString()
                    };

                    simpanKonten(konten);
                };
                reader.readAsDataURL(file);
            }
            // Jika jenis adalah "teks"
            else if (jenis === "teks") {
                if (!teks) {
                    alert("Isi teks tidak boleh kosong.");
                    return;
                }

                const konten = {
                    id: Date.now().toString(),
                    userId,
                    userName,
                    judul,
                    kategori,
                    jenis,
                    gambar: null,
                    teks: teks,
                    waktu: new Date().toISOString()
                };

                simpanKonten(konten);
            }
            else {
                alert("Jenis konten belum dipilih.");
            }
        }

        // Fungsi simpan konten ke localStorage
        function simpanKonten(konten) {
            const data = JSON.parse(localStorage.getItem("konten") || "[]");
            data.push(konten);
            localStorage.setItem("konten", JSON.stringify(data));

            alert("Konten berhasil diunggah!");
            window.location.href = "my.html";
        }


        function isiDropdownKategori() {
            const select = document.getElementById("kategori");
            const list = JSON.parse(localStorage.getItem("kategoriList") || "[]");

            select.innerHTML = '<option value="">-- Pilih Kategori --</option>'; // kosongkan dulu
            if (list.length === 0) {
                const opt = document.createElement("option");
                opt.text = "Belum ada kategori tersedia";
                opt.disabled = true;
                select.appendChild(opt);
                select.disabled = true;
                return;
            }

            list.forEach(kat => {
                const opt = document.createElement("option");
                opt.value = kat;
                opt.textContent = kat.charAt(0).toUpperCase() + kat.slice(1);
                select.appendChild(opt);
            });
        }

        function toggleField() {
            const jenis = document.getElementById("jenis").value;
            const fieldGambar = document.getElementById("fieldGambar");
            const fieldTeks = document.getElementById("fieldTeks");
            const gambarInput = document.getElementById("gambar");
            const teksInput = document.getElementById("teks");

            if (jenis === "gambar") {
                fieldGambar.style.display = "block";
                fieldTeks.style.display = "none";
                gambarInput.required = true;
                teksInput.required = false;
            } else if (jenis === "teks") {
                fieldGambar.style.display = "none";
                fieldTeks.style.display = "block";
                gambarInput.required = false;
                teksInput.required = true;
            } else {
                fieldGambar.style.display = "none";
                fieldTeks.style.display = "none";
                gambarInput.required = false;
                teksInput.required = false;
            }
        }


        // Jalankan saat halaman load
        window.onload = function () {
            isiDropdownKategori();
        }

    </script>

</body>

</html>